name: Build Telegram Bot APK

on: [workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Build using alternative Docker image
      run: |
        # استفاده از image متفاوت که root warning ندارد
        docker run --rm \
          -v $(pwd):/src \
          -e "P4A_RELEASE_KEYSTORE=/src/keystore.keystore" \
          -e "P4A_RELEASE_KEYALIAS=key" \
          beevelop/cordova bash -c "
          cd /src &&
          apt-get update &&
          apt-get install -y python3-pip &&
          pip3 install buildozer &&
          echo y | buildozer android debug
          "
          
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: telegram-bot
        path: bin/*.apk
